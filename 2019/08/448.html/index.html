<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Hacking the Data Transformation Interview - Blind with Science</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="ziyunch" /><meta name="description" content="I am currently (still) seeking a job in data/software engineering area, and I am preparing for all kinds of technical interviews, ranging from coding, algorithm, system design, SQL to computer science fundamental quiz. Data engineer is a role with vague definition, and people with this title functions as an ETL (extract, transformation, load) engineer in some companies. Thus, topics on data transformation could be covered during the interview. In this blog, I am trying to hack interview focusing on data tranformation.
" /><meta name="keywords" content="ziyunch, blog" />






<meta name="generator" content="Hugo 0.149.0 with theme even" />


<link rel="canonical" href="http://blindwith.science/2019/08/448.html/" />
<link rel="apple-touch-icon" sizes="180x180" href="../../../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../../../favicon-16x16.png">
<link rel="manifest" href="../../../manifest.json">
<link rel="mask-icon" href="../../../safari-pinned-tab.svg" color="#5bbad5">



<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="../../../sass/main.min.22b0d99d8a618713080069182ee3608a4528452925f4324879d7352bfccb78bd.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:url" content="http://blindwith.science/2019/08/448.html/">
  <meta property="og:site_name" content="Blind with Science">
  <meta property="og:title" content="Hacking the Data Transformation Interview">
  <meta property="og:description" content="I am currently (still) seeking a job in data/software engineering area, and I am preparing for all kinds of technical interviews, ranging from coding, algorithm, system design, SQL to computer science fundamental quiz. Data engineer is a role with vague definition, and people with this title functions as an ETL (extract, transformation, load) engineer in some companies. Thus, topics on data transformation could be covered during the interview. In this blog, I am trying to hack interview focusing on data tranformation.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2019-08-30T11:14:00-07:00">
    <meta property="article:modified_time" content="2021-01-18T17:22:59-08:00">
    <meta property="article:tag" content="Data-Engineering">
    <meta property="article:tag" content="Interview">
    <meta property="article:tag" content="Python">

  <meta itemprop="name" content="Hacking the Data Transformation Interview">
  <meta itemprop="description" content="I am currently (still) seeking a job in data/software engineering area, and I am preparing for all kinds of technical interviews, ranging from coding, algorithm, system design, SQL to computer science fundamental quiz. Data engineer is a role with vague definition, and people with this title functions as an ETL (extract, transformation, load) engineer in some companies. Thus, topics on data transformation could be covered during the interview. In this blog, I am trying to hack interview focusing on data tranformation.">
  <meta itemprop="datePublished" content="2019-08-30T11:14:00-07:00">
  <meta itemprop="dateModified" content="2021-01-18T17:22:59-08:00">
  <meta itemprop="wordCount" content="526">
  <meta itemprop="keywords" content="Data-Engineering,Interview,Python">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Hacking the Data Transformation Interview">
  <meta name="twitter:description" content="I am currently (still) seeking a job in data/software engineering area, and I am preparing for all kinds of technical interviews, ranging from coding, algorithm, system design, SQL to computer science fundamental quiz. Data engineer is a role with vague definition, and people with this title functions as an ETL (extract, transformation, load) engineer in some companies. Thus, topics on data transformation could be covered during the interview. In this blog, I am trying to hack interview focusing on data tranformation.">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="../../../" class="logo">Blind with Science</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="../../../">
        <li class="mobile-menu-item">首页</li>
      </a><a href="../../../post/">
        <li class="mobile-menu-item">归档</li>
      </a><a href="../../../tags/">
        <li class="mobile-menu-item">标签</li>
      </a><a href="../../../categories/">
        <li class="mobile-menu-item">分类</li>
      </a><a href="../../../about/">
        <li class="mobile-menu-item">关于我</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="../../../" class="logo">Blind with Science</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="../../../">首页</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="../../../post/">归档</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="../../../tags/">标签</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="../../../categories/">分类</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="../../../about/">关于我</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Hacking the Data Transformation Interview</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-08-30 </span>
        <div class="post-category">
            <a href="../../../categories/%E6%8A%80%E6%9C%AF%E5%AE%85/"> 技术宅 </a>
            </div>
          <span class="more-meta"> 约 526 字 </span>
          <span class="more-meta"> 预计阅读 2 分钟 </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="../../../img/spinner.svg" alt="spinner.svg"/></span> 次阅读 </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites-boto3">Prerequisites: boto3</a></li>
    <li><a href="#prerequisites-psycopg2">Prerequisites: psycopg2</a></li>
    <li><a href="#upload-data-from-s3-into-redshift">Upload data from S3 into Redshift</a></li>
    <li><a href="#load-data-from-redshift-to-pandas">Load data from Redshift to pandas</a></li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="warn">
      <p>【注意】最后更新于 <span class="timeago" datetime="2021-01-18T17:22:59" title="January 18, 2021">January 18, 2021</span>，文中内容可能已过时，请谨慎使用。</p>
    </div>
  </div>
    <div class="post-content">
      <p>I am currently (still) seeking a job in data/software engineering area, and I am preparing for all kinds of technical interviews, ranging from coding, algorithm, system design, SQL to computer science fundamental quiz. Data engineer is a role with vague definition, and people with this title functions as an ETL (extract, transformation, load) engineer in some companies. Thus, topics on data transformation could be covered during the interview. In this blog, I am trying to hack interview focusing on data tranformation.</p>
<h2 id="prerequisites-boto3">Prerequisites: boto3</h2>
<p>Boto is the AWS SDK for python, which provides easy-to-use, object-oriented API and low-level access to AWS services. We could find the documentation <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html">here</a>.</p>
<p>We could easily install the latest Boto 3 release via pip:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pip install boto3
</span></span></code></pre></div><p>Then configure the credential file at <code>~/.aws/credentials</code>:</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">[default]
aws_access_key_id = YOUR_ACCESS_KEY
aws_secret_access_key = YOUR_SECRET_KEY
</code></pre><p>And set the default region at <code>~/.aws/config</code>:</p>
<pre tabindex="0"><code class="language-nil" data-lang="nil">[default]
region=us-east-1
</code></pre><p>To use boto3, we could import it and pass the service-to-use to it. For example, to use Amazon S3, we could choose a resource by:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> boto3
</span></span><span style="display:flex;"><span>s3 <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>resource(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span></code></pre></div><p>Create a s3 bucket over client level:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>s3_client <span style="color:#f92672">=</span> boto3<span style="color:#f92672">.</span>client(<span style="color:#e6db74">&#39;s3&#39;</span>)
</span></span><span style="display:flex;"><span>s3_client<span style="color:#f92672">.</span>create_bucket(Bucket<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;BUCKET_NAME&#39;</span>)
</span></span></code></pre></div><p>List existing buckets for the AWS account:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>response <span style="color:#f92672">=</span> s3_client<span style="color:#f92672">.</span>list_buckets()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> bucket <span style="color:#f92672">in</span> response[<span style="color:#e6db74">&#39;Buckets&#39;</span>]:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;  </span><span style="color:#e6db74">{</span>bucket[<span style="color:#e6db74">&#34;Name&#34;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>)
</span></span></code></pre></div><p>Upload file into a s3 bucket:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>response <span style="color:#f92672">=</span> s3_client<span style="color:#f92672">.</span>upload_file(file_name, bucket, object_name)
</span></span></code></pre></div><p>Or upload object in binary mode into a s3 bucket:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;test.jpg&#39;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    s3<span style="color:#f92672">.</span>upload_fileobj(f, <span style="color:#e6db74">&#34;BUCKET_NAME&#34;</span>, <span style="color:#e6db74">&#34;OBJECT_NAME&#34;</span>)
</span></span></code></pre></div><p>Or directly put object into a s3 bucket over the bucket level:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>data <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;test.jpg&#39;</span>, <span style="color:#e6db74">&#39;rb&#39;</span>)
</span></span><span style="display:flex;"><span>bucket <span style="color:#f92672">=</span> s3<span style="color:#f92672">.</span>Bucket(<span style="color:#e6db74">&#39;my-bucket&#39;</span>)
</span></span><span style="display:flex;"><span>bucket<span style="color:#f92672">.</span>put_object(Key<span style="color:#f92672">=</span>object_name, Body<span style="color:#f92672">=</span>data)
</span></span></code></pre></div><p>To download file from a S3 bucket, we could:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>s3<span style="color:#f92672">.</span>download_file(<span style="color:#e6db74">&#39;BUCKET_NAME&#39;</span>, <span style="color:#e6db74">&#39;OBJECT_NAME&#39;</span>, <span style="color:#e6db74">&#39;FILE_NAME&#39;</span>)
</span></span></code></pre></div><p>Or:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;FILE_NAME&#39;</span>, <span style="color:#e6db74">&#39;wb&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    s3<span style="color:#f92672">.</span>download_fileobj(<span style="color:#e6db74">&#39;BUCKET_NAME&#39;</span>, <span style="color:#e6db74">&#39;OBJECT_NAME&#39;</span>, f)
</span></span></code></pre></div><p>We could also set configuration when uploading, downloading, or copying a file or S3 object by:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> boto3.s3.transfer <span style="color:#f92672">import</span> TransferConfig
</span></span><span style="display:flex;"><span>GB <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">**</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>config <span style="color:#f92672">=</span> TransferConfig(multipart_threshold<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span><span style="color:#f92672">*</span>GB)
</span></span><span style="display:flex;"><span>config <span style="color:#f92672">=</span> TransferConfig(max_concurrency<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
</span></span><span style="display:flex;"><span>config <span style="color:#f92672">=</span> TransferConfig(use_threads<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>s3<span style="color:#f92672">.</span>upload_file(<span style="color:#e6db74">&#39;FILE_NAME&#39;</span>, <span style="color:#e6db74">&#39;BUCKET_NAME&#39;</span>, <span style="color:#e6db74">&#39;OBJECT_NAME&#39;</span>, Config<span style="color:#f92672">=</span>config)
</span></span></code></pre></div><h2 id="prerequisites-psycopg2">Prerequisites: psycopg2</h2>
<p>Psycopg2 is a popular PostgreSQL database adapter for python. We could find documentation <a href="http://initd.org/psycopg/docs/">here</a>.</p>
<p>We could easily install psycopg2 via pip:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ pip install psycopg2-binary
</span></span></code></pre></div><p>To use psycopg2, we could import it, connect to an existing database and open a cursor to perform database operations:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> psycopg2
</span></span><span style="display:flex;"><span>conn <span style="color:#f92672">=</span> psycopg2<span style="color:#f92672">.</span>connect(dbname<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;DATABASE_NAME&#34;</span>, user<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;USER&#34;</span>, host<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;HOST&#34;</span>, port<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PORT&#34;</span>, password<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PASSWORD&#34;</span>)
</span></span><span style="display:flex;"><span>cur <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>cursor()
</span></span></code></pre></div><p>Query the database and fetch data in an iteration-like way:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>cur<span style="color:#f92672">.</span>execute(sql_query)
</span></span><span style="display:flex;"><span>cur<span style="color:#f92672">.</span>fetchone()
</span></span><span style="display:flex;"><span>cur<span style="color:#f92672">.</span>fetchmany(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>cur<span style="color:#f92672">.</span>fetchall()
</span></span></code></pre></div><p>Pass parameters to SQL queries:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>cur<span style="color:#f92672">.</span>execute(<span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    INSERT INTO some_table (an_int, a_date, another_date, a_string)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    VALUES (</span><span style="color:#e6db74">%(int)s</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%(date)s</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%(date)s</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%(str)s</span><span style="color:#e6db74">);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#34;&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>    {<span style="color:#e6db74">&#39;int&#39;</span>: <span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;str&#39;</span>: <span style="color:#e6db74">&#34;O&#39;Reilly&#34;</span>, <span style="color:#e6db74">&#39;date&#39;</span>: datetime<span style="color:#f92672">.</span>date(<span style="color:#ae81ff">2005</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">18</span>)})
</span></span></code></pre></div><p>Make the changes to the database persistent:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>conn<span style="color:#f92672">.</span>commit()
</span></span></code></pre></div><p>Close communication with the database</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>cur<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>conn<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><h2 id="upload-data-from-s3-into-redshift">Upload data from S3 into Redshift</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    connection_parameters <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;dbname&#39;</span>: dbname,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;user&#39;</span>: user,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;host&#39;</span>: host,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;port&#39;</span>: port,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;password&#39;</span>: password
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        conn <span style="color:#f92672">=</span> psycopg2<span style="color:#f92672">.</span>connect(<span style="color:#f92672">**</span>connection_parameters)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Connected to Redshift.&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Unable to connect to Redshift.&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    cur <span style="color:#f92672">=</span> conn<span style="color:#f92672">.</span>cursor()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    upload_statement <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>            COPY {}<span style="color:#f92672">.</span>{}
</span></span><span style="display:flex;"><span>            FROM {}
</span></span><span style="display:flex;"><span>            IAM_ROLE {}
</span></span><span style="display:flex;"><span>            CSV;
</span></span><span style="display:flex;"><span>            COMMIT;
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;.format(table_name, schema, file_name, iam_role)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>        cur<span style="color:#f92672">.</span>execute(upload_statement)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Upload successfully&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">except</span> psycopg2<span style="color:#f92672">.</span>Error:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">raise</span> ExecuteFailure(<span style="color:#e6db74">&#34;Failed to upload the file.&#34;</span>)
</span></span><span style="display:flex;"><span>    cur<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>    conn<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><h2 id="load-data-from-redshift-to-pandas">Load data from Redshift to pandas</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> sqlalchemy <span style="color:#66d9ef">as</span> sa
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span>surl <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;redshift+psycopg2://&#39;</span>
</span></span><span style="display:flex;"><span>engine <span style="color:#f92672">=</span> sa<span style="color:#f92672">.</span>create_engine(surl<span style="color:#f92672">+</span>user<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;:&#39;</span><span style="color:#f92672">+</span>password<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;@&#39;</span><span style="color:#f92672">+</span>host<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;:&#39;</span><span style="color:#f92672">+</span>port<span style="color:#f92672">+</span><span style="color:#e6db74">&#39;/&#39;</span><span style="color:#f92672">+</span>dbname,echo<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_sql_query(<span style="color:#e6db74">&#39;SELECT * FROM table ;&#39;</span>, engine)
</span></span></code></pre></div>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">ziyunch</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2021-01-18
        
    </span>
  </p>
  
  
</div>
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    <label class="qr-code-image" for="reward">
        <img class="image" src="../../../images/wechatpay.jpg">
        <span>微信打赏</span>
      </label>
    
  </div>
</div><footer class="post-footer">
      <div class="post-tags">
          <a href="../../../tags/data-engineering/">Data-Engineering</a>
          <a href="../../../tags/interview/">Interview</a>
          <a href="../../../tags/python/">Python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="../../../2019/08/449.html/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Mac 版 Emacs 中使用 Rime 输入法打带调双拼</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="../../../2019/08/447.html/">
            <span class="next-text nav-default">博客由 Hexo 迁移至 Hugo</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  <script src="https://unpkg.com/@waline/client@v2/dist/waline.js"></script>
  <link
    rel="stylesheet"
    href="https://unpkg.com/@waline/client@v2/dist/waline.css"
    />
  <div id="waline"></div>
  <script>
    Waline.init({
      el: '#waline',
      serverURL: 'https:\/\/waline-ziyunch.vercel.app',
      pageview:  true ,
      avatar: 'robohash',
    });
  </script>

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/ziyunch" class="iconfont icon-github" title="github">
      </a>
      <a href="http://weibo.com/ziyunch" class="iconfont icon-weibo" title="weibo">
      </a>
      <a href="http://douban.com/people/ziyunch" class="iconfont icon-douban" title="douban">
      </a>
      <a href="https://mastodon.blindwith.science" class="iconfont icon-mastodon" title="mastodon"><svg class="icon" style="" viewBox="0 0 448 512" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="28" height="28"><path fill="currentColor" d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"></path></svg>
      </a>
  
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> 本站总访问量 <span id="busuanzi_value_site_pv"><img src="../../../img/spinner.svg" alt="spinner.svg"/></span> 次 </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> 本站总访客数 <span id="busuanzi_value_site_uv"><img src="../../../img/spinner.svg" alt="spinner.svg"/></span> 人 </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2005 - 
    2025<span class="heart"><i class="iconfont icon-heart"></i></span><span>ziyunch</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script>
    var languageCode = "en".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>



<script type="text/javascript" src="../../../js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
